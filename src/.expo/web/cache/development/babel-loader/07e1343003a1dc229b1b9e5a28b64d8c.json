{"ast":null,"code":"var _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nvar _interopRequireWildcard = require(\"@babel/runtime/helpers/interopRequireWildcard\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.SmartpriceModal = void 0;\n\nvar _extends2 = _interopRequireDefault(require(\"@babel/runtime/helpers/extends\"));\n\nvar _slicedToArray2 = _interopRequireDefault(require(\"@babel/runtime/helpers/slicedToArray\"));\n\nvar _react = _interopRequireWildcard(require(\"react\"));\n\nvar _View = _interopRequireDefault(require(\"react-native-web/dist/exports/View\"));\n\nvar _Animated = _interopRequireDefault(require(\"react-native-web/dist/exports/Animated\"));\n\nvar _Dimensions = _interopRequireDefault(require(\"react-native-web/dist/exports/Dimensions\"));\n\nvar _Easing = _interopRequireDefault(require(\"react-native-web/dist/exports/Easing\"));\n\nvar _Platform = _interopRequireDefault(require(\"react-native-web/dist/exports/Platform\"));\n\nvar _ActivityIndicator = _interopRequireDefault(require(\"react-native-web/dist/exports/ActivityIndicator\"));\n\nvar _smartpriceModal = require(\"./smartprice-modal.styles\");\n\nvar _smartpriceModalHeader = require(\"../header/smartprice-modal-header\");\n\nvar _smartpriceFooter = require(\"../footer/smartprice-footer\");\n\nvar _phoneForm = require(\"../forms/phone-form/phone-form\");\n\nvar _verifyIdentityForm = require(\"../forms/verify-identity-form/verify-identity-form\");\n\nvar _cardForm = require(\"../forms/card-form/card-form\");\n\nvar _createAccountForm = require(\"../forms/create-account-form/create-account-form\");\n\nrequire(\"@expo/match-media\");\n\nvar _smartpriceApi = require(\"../api/smartprice-api\");\n\nvar _colors = require(\"../utils/types/colors\");\n\nvar _this = this,\n    _jsxFileName = \"/Users/willhwang/Desktop/react-native-smartprice/src/src/component/modal/smartprice-modal.tsx\";\n\nvar SmartpriceModal = function SmartpriceModal(_ref) {\n  var viewStyle = _ref.viewStyle,\n      onClose = _ref.onClose,\n      isOpen = _ref.isOpen,\n      onContinueFlow = _ref.onContinueFlow;\n\n  var deviceHeight = _Dimensions.default.get('screen').height;\n\n  var _useState = (0, _react.useState)(1),\n      _useState2 = (0, _slicedToArray2.default)(_useState, 2),\n      flowStep = _useState2[0],\n      setFlowStep = _useState2[1];\n\n  var _useState3 = (0, _react.useState)(''),\n      _useState4 = (0, _slicedToArray2.default)(_useState3, 2),\n      registerPhoneNumber = _useState4[0],\n      setRegisterPhoneNumber = _useState4[1];\n\n  var _useState5 = (0, _react.useState)(),\n      _useState6 = (0, _slicedToArray2.default)(_useState5, 2),\n      memberInfo = _useState6[0],\n      setMemberInfo = _useState6[1];\n\n  var _useState7 = (0, _react.useState)(''),\n      _useState8 = (0, _slicedToArray2.default)(_useState7, 2),\n      deviceToken = _useState8[0],\n      setDeviceToken = _useState8[1];\n\n  var _useState9 = (0, _react.useState)(''),\n      _useState10 = (0, _slicedToArray2.default)(_useState9, 2),\n      verificationCode = _useState10[0],\n      setVerificationCode = _useState10[1];\n\n  var _useState11 = (0, _react.useState)(''),\n      _useState12 = (0, _slicedToArray2.default)(_useState11, 2),\n      verifyErrorMessage = _useState12[0],\n      setVerifyErrorMessage = _useState12[1];\n\n  var _useState13 = (0, _react.useState)(''),\n      _useState14 = (0, _slicedToArray2.default)(_useState13, 2),\n      currentError = _useState14[0],\n      setCurrentError = _useState14[1];\n\n  var _useState15 = (0, _react.useState)(false),\n      _useState16 = (0, _slicedToArray2.default)(_useState15, 2),\n      isBusy = _useState16[0],\n      setIsBusy = _useState16[1];\n\n  var onCreateAccount = function onCreateAccount(userInfo) {\n    setIsBusy(true);\n\n    if (userInfo !== null && deviceToken !== '') {\n      var _registerAppUser;\n\n      (_registerAppUser = (0, _smartpriceApi.registerAppUser)(userInfo, deviceToken)) == null ? void 0 : _registerAppUser.then(function (response) {\n        var memberInformation = response.data;\n\n        if (memberInformation.memberId !== undefined) {\n          setIsBusy(false);\n          setMemberInfo(memberInformation);\n          setFlowStep(4);\n        }\n      }).catch(function (e) {\n        if (e.response.data.status === 'failure') {\n          setIsBusy(false);\n          setFlowStep(3);\n          setVerifyErrorMessage(\"We couldn't create your account, please try again later\");\n        }\n      });\n    } else {\n      setIsBusy(false);\n      setVerifyErrorMessage('Please, fill all the fields');\n    }\n  };\n\n  var onVerificationCodeRequest = function onVerificationCodeRequest(phoneNumber) {\n    setIsBusy(true);\n    (0, _smartpriceApi.sendVerificationCodeRequest)(phoneNumber).then(function (_) {\n      setIsBusy(false);\n      setFlowStep(2);\n      setRegisterPhoneNumber(phoneNumber);\n      setCurrentError('');\n    }).catch(function (e) {\n      setIsBusy(false);\n      setCurrentError(e);\n    });\n  };\n\n  var onSendVerificationCode = function onSendVerificationCode(code) {\n    setIsBusy(true);\n\n    if (registerPhoneNumber) {\n      setVerificationCode(code);\n      (0, _smartpriceApi.getDeviceToken)(code, registerPhoneNumber).then(function (response) {\n        if (response.status === 'success') {\n          if (!response.data.deviceToken) {} else {\n            var token = response.data.deviceToken;\n            setDeviceToken(token);\n            (0, _smartpriceApi.isRegisteredUser)(token).then(function (r) {\n              if (!r.data) {\n                setIsBusy(false);\n                setFlowStep(3);\n              } else {\n                (0, _smartpriceApi.getMemberInformation)(token).then(function (info) {\n                  var memberInformation = info.data;\n\n                  if (memberInformation.memberId !== undefined) {\n                    setMemberInfo(memberInformation);\n                    setIsBusy(false);\n                    setFlowStep(4);\n                  }\n                }).catch(function (e) {\n                  if (e.response.data.status === 'failure') {\n                    setFlowStep(3);\n                    setIsBusy(false);\n                    setVerifyErrorMessage(\"No information available\");\n                  }\n                });\n              }\n            }).catch(function (_) {\n              setFlowStep(1);\n              setIsBusy(false);\n              setCurrentError('Something went wrong, please try again later');\n            });\n          }\n        }\n      }).catch(function (_) {\n        setFlowStep(1);\n        setIsBusy(false);\n        setCurrentError('Something went wrong, please try again later');\n      });\n    }\n  };\n\n  var switchForm = function switchForm(formStep) {\n    if (formStep >= 1 || formStep <= 3) {\n      switch (formStep) {\n        case 1:\n          return _react.default.createElement(_phoneForm.PhoneForm, {\n            onVerificationCodeRequest: onVerificationCodeRequest,\n            errorMessage: currentError,\n            userNumber: registerPhoneNumber,\n            __self: _this,\n            __self: _this,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 161,\n              columnNumber: 13\n            }\n          });\n\n        case 2:\n          return _react.default.createElement(_verifyIdentityForm.VerifyIdentityForm, {\n            phoneNumber: registerPhoneNumber,\n            onSendVerificationCode: onSendVerificationCode,\n            resendRequestVerificationCode: onVerificationCodeRequest,\n            errorMessage: currentError,\n            __self: _this,\n            __self: _this,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 169,\n              columnNumber: 13\n            }\n          });\n\n        case 3:\n          return _react.default.createElement(_createAccountForm.CreateAccountForm, {\n            verificationCode: verificationCode,\n            deviceToken: deviceToken,\n            phoneNumber: registerPhoneNumber,\n            onCreateAccount: onCreateAccount,\n            verifyErrorMessage: verifyErrorMessage,\n            __self: _this,\n            __self: _this,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 178,\n              columnNumber: 13\n            }\n          });\n\n        case 4:\n          return _react.default.createElement(_cardForm.CardForm, {\n            memberInfo: memberInfo,\n            onContinue: onContinueFlowDefined,\n            __self: _this,\n            __self: _this,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 188,\n              columnNumber: 13\n            }\n          });\n      }\n    }\n  };\n\n  var onContinueFlowDefined = function onContinueFlowDefined() {\n    if (onContinueFlow) {\n      onContinueFlow();\n    } else {\n      onCloseModal();\n    }\n  };\n\n  var backButton = flowStep > 1 && flowStep < 4;\n\n  var onCloseModal = function onCloseModal() {\n    slideOut();\n    setRegisterPhoneNumber('');\n    setCurrentError('');\n    setFlowStep(1);\n  };\n\n  var onBackButtonPressed = function onBackButtonPressed() {\n    return flowStep > 1 ? setFlowStep(flowStep - 1) : setFlowStep(1);\n  };\n\n  var slideAnim = (0, _react.useRef)(new _Animated.default.Value(deviceHeight)).current;\n\n  var slideIn = function slideIn() {\n    _Animated.default.timing(slideAnim, {\n      toValue: 7.3891 * deviceHeight / 100,\n      duration: 300,\n      easing: _Easing.default.exp,\n      useNativeDriver: _Platform.default.OS !== 'web' ? true : false\n    }).start();\n  };\n\n  var slideOut = function slideOut() {\n    _Animated.default.timing(slideAnim, {\n      toValue: deviceHeight,\n      duration: 400,\n      easing: _Easing.default.exp,\n      useNativeDriver: _Platform.default.OS !== 'web' ? true : false\n    }).start(function (anim) {\n      if (anim.finished) {\n        setTimeout(onClose, 100);\n      }\n    });\n  };\n\n  var slideInAnimationStyle = [_smartpriceModal.smartpriceModalStyles.containerViewStyle, {\n    marginTop: slideAnim\n  }];\n  var activityIndicatorStyle = (0, _extends2.default)({}, _smartpriceModal.smartpriceModalStyles.activityIndicatorViewStyle, {\n    display: isBusy ? 'flex' : 'none'\n  });\n  (0, _react.useEffect)(function () {\n    if (isOpen === true) {\n      slideIn();\n    }\n  }, [isOpen]);\n  return _react.default.createElement(_View.default, {\n    style: viewStyle,\n    __self: _this,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 260,\n      columnNumber: 5\n    }\n  }, _react.default.createElement(_Animated.default.View, {\n    style: slideInAnimationStyle,\n    __self: _this,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 261,\n      columnNumber: 7\n    }\n  }, _react.default.createElement(_smartpriceModalHeader.SmartpriceModalHeader, {\n    isBackButtonEnabled: backButton,\n    onClose: onCloseModal,\n    onBackButtonPressed: onBackButtonPressed,\n    __self: _this,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 262,\n      columnNumber: 9\n    }\n  }), _react.default.createElement(_View.default, {\n    style: _smartpriceModal.smartpriceModalStyles.scrollContainerViewStyle,\n    __self: _this,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 267,\n      columnNumber: 9\n    }\n  }, _react.default.createElement(_View.default, {\n    style: _smartpriceModal.smartpriceModalStyles.formContainerViewStyle,\n    __self: _this,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 268,\n      columnNumber: 11\n    }\n  }, switchForm(flowStep)), _react.default.createElement(_smartpriceFooter.SmartpriceFooter, {\n    __self: _this,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 271,\n      columnNumber: 11\n    }\n  })), _react.default.createElement(_View.default, {\n    style: activityIndicatorStyle,\n    __self: _this,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 273,\n      columnNumber: 9\n    }\n  }, _react.default.createElement(_ActivityIndicator.default, {\n    hidesWhenStopped: true,\n    color: _colors.PurpleScale.dark,\n    animating: isBusy,\n    size: \"large\",\n    __self: _this,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 274,\n      columnNumber: 11\n    }\n  }))));\n};\n\nexports.SmartpriceModal = SmartpriceModal;","map":{"version":3,"sources":["/Users/willhwang/Desktop/react-native-smartprice/src/src/component/modal/smartprice-modal.tsx"],"names":["SmartpriceModal","viewStyle","onClose","isOpen","onContinueFlow","deviceHeight","Dimensions","get","height","flowStep","setFlowStep","registerPhoneNumber","setRegisterPhoneNumber","memberInfo","setMemberInfo","deviceToken","setDeviceToken","verificationCode","setVerificationCode","verifyErrorMessage","setVerifyErrorMessage","currentError","setCurrentError","isBusy","setIsBusy","onCreateAccount","userInfo","then","response","memberInformation","data","memberId","undefined","catch","e","status","onVerificationCodeRequest","phoneNumber","_","onSendVerificationCode","code","token","r","info","switchForm","formStep","onContinueFlowDefined","onCloseModal","backButton","slideOut","onBackButtonPressed","slideAnim","Animated","Value","current","slideIn","timing","toValue","duration","easing","Easing","exp","useNativeDriver","Platform","OS","start","anim","finished","setTimeout","slideInAnimationStyle","smartpriceModalStyles","containerViewStyle","marginTop","activityIndicatorStyle","activityIndicatorViewStyle","display","scrollContainerViewStyle","formContainerViewStyle","PurpleScale","dark"],"mappings":"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","sourcesContent":["// Copyright 2021 Prescryptive Health, Inc.\nimport React, { FunctionComponent, useState, useRef, useEffect } from 'react';\nimport {\n  View,\n  StyleProp,\n  ViewStyle,\n  Animated,\n  Dimensions,\n  Easing,\n  Platform,\n  ActivityIndicator,\n} from 'react-native';\nimport { smartpriceModalStyles } from './smartprice-modal.styles';\nimport { SmartpriceModalHeader } from '../header/smartprice-modal-header';\nimport { SmartpriceFooter } from '../footer/smartprice-footer';\nimport { PhoneForm } from '../forms/phone-form/phone-form';\nimport { VerifyIdentityForm } from '../forms/verify-identity-form/verify-identity-form';\nimport { CardForm } from '../forms/card-form/card-form';\nimport { CreateAccountForm } from '../forms/create-account-form/create-account-form';\nimport '@expo/match-media';\nimport {\n  getDeviceToken,\n  getMemberInformation,\n  IApiResponseError,\n  IDeviceTokenResponse,\n  IFormData,\n  IMemberInfoResponse,\n  IMemberInformation,\n  isRegisteredUser,\n  registerAppUser,\n  sendVerificationCodeRequest,\n} from '../api/smartprice-api';\nimport { PurpleScale } from '../utils/types/colors';\nimport * as Progress from 'react-native-progress';\nexport interface ISmartpriceModalProps {\n  viewStyle?: StyleProp<ViewStyle>;\n  onClose: () => void;\n  isOpen: boolean;\n  onMemberInfo?: (info: string) => void;\n  onContinueFlow?: () => void;\n}\n\nexport const SmartpriceModal: FunctionComponent<ISmartpriceModalProps> = ({\n  viewStyle,\n  onClose,\n  isOpen,\n  onContinueFlow,\n}): React.ReactElement => {\n  const deviceHeight = Dimensions.get('screen').height;\n\n  const [flowStep, setFlowStep] = useState<number>(1);\n  const [registerPhoneNumber, setRegisterPhoneNumber] = useState<string>('');\n  const [memberInfo, setMemberInfo] = useState<IMemberInformation>();\n  const [deviceToken, setDeviceToken] = useState<string>('');\n  const [verificationCode, setVerificationCode] = useState<string>('');\n  const [verifyErrorMessage, setVerifyErrorMessage] = useState<string>('');\n  const [currentError, setCurrentError] = useState<string>('');\n  const [isBusy, setIsBusy] = useState<boolean>(false);\n\n  const onCreateAccount = (userInfo: IFormData) => {\n    setIsBusy(true);\n    if (userInfo !== null && deviceToken !== '') {\n      registerAppUser(userInfo, deviceToken)\n        ?.then((response: IMemberInfoResponse) => {\n          const memberInformation = response.data as IMemberInformation;\n          if (memberInformation.memberId !== undefined) {\n            setIsBusy(false);\n            setMemberInfo(memberInformation);\n            setFlowStep(4);\n          }\n        })\n        .catch((e: IApiResponseError) => {\n          if (e.response.data.status === 'failure') {\n            setIsBusy(false);\n            setFlowStep(3);\n            setVerifyErrorMessage(\n              `We couldn't create your account, please try again later`\n            );\n          }\n        });\n    } else {\n      setIsBusy(false);\n      setVerifyErrorMessage('Please, fill all the fields');\n    }\n  };\n\n  const onVerificationCodeRequest = (phoneNumber: string) => {\n    setIsBusy(true);\n    sendVerificationCodeRequest(phoneNumber)\n      .then((_) => {\n        setIsBusy(false);\n        setFlowStep(2);\n        setRegisterPhoneNumber(phoneNumber);\n        setCurrentError('');\n      })\n      .catch((e: string) => {\n        setIsBusy(false);\n        setCurrentError(e);\n      });\n  };\n\n  const onSendVerificationCode = (code: string) => {\n    setIsBusy(true);\n    if (registerPhoneNumber) {\n      setVerificationCode(code);\n      getDeviceToken(code, registerPhoneNumber)\n        .then((response: IDeviceTokenResponse) => {\n          if (response.status === 'success') {\n            if (!response.data.deviceToken) {\n              // Can we have a success but not deviceToken?\n            } else {\n              const token = response.data.deviceToken;\n              setDeviceToken(token);\n              isRegisteredUser(token)\n                .then((r) => {\n                  if (!r.data) {\n                    setIsBusy(false);\n                    setFlowStep(3);\n                  } else {\n                    getMemberInformation(token)\n                      .then((info: IMemberInfoResponse) => {\n                        const memberInformation = info.data as IMemberInformation;\n                        if (memberInformation.memberId !== undefined) {\n                          setMemberInfo(memberInformation);\n                          setIsBusy(false);\n                          setFlowStep(4);\n                        }\n                      })\n                      .catch((e: IApiResponseError) => {\n                        if (e.response.data.status === 'failure') {\n                          setFlowStep(3);\n                          setIsBusy(false);\n                          setVerifyErrorMessage(`No information available`);\n                        }\n                      });\n                  }\n                })\n                .catch((_) => {\n                  setFlowStep(1);\n                  setIsBusy(false);\n                  setCurrentError(\n                    'Something went wrong, please try again later'\n                  );\n                });\n            }\n          }\n        })\n        .catch((_: IApiResponseError) => {\n          setFlowStep(1);\n          setIsBusy(false);\n          setCurrentError('Something went wrong, please try again later');\n        });\n    }\n  };\n\n  const switchForm = (formStep: number) => {\n    if (formStep >= 1 || formStep <= 3) {\n      switch (formStep) {\n        case 1:\n          return (\n            <PhoneForm\n              onVerificationCodeRequest={onVerificationCodeRequest}\n              errorMessage={currentError}\n              userNumber={registerPhoneNumber}\n            />\n          );\n        case 2:\n          return (\n            <VerifyIdentityForm\n              phoneNumber={registerPhoneNumber}\n              onSendVerificationCode={onSendVerificationCode}\n              resendRequestVerificationCode={onVerificationCodeRequest}\n              errorMessage={currentError}\n            />\n          );\n        case 3:\n          return (\n            <CreateAccountForm\n              verificationCode={verificationCode}\n              deviceToken={deviceToken}\n              phoneNumber={registerPhoneNumber}\n              onCreateAccount={onCreateAccount}\n              verifyErrorMessage={verifyErrorMessage}\n            />\n          );\n        case 4:\n          return (\n            <CardForm\n              memberInfo={memberInfo}\n              onContinue={onContinueFlowDefined}\n            />\n          );\n      }\n    }\n  };\n\n  const onContinueFlowDefined = () => {\n    if (onContinueFlow) {\n      onContinueFlow();\n    } else {\n      onCloseModal();\n    }\n  };\n\n  const backButton = flowStep > 1 && flowStep < 4;\n\n  const onCloseModal = () => {\n    slideOut();\n    setRegisterPhoneNumber('');\n    setCurrentError('');\n    setFlowStep(1);\n  };\n\n  const onBackButtonPressed = () =>\n    flowStep > 1 ? setFlowStep(flowStep - 1) : setFlowStep(1);\n\n  const slideAnim = useRef(new Animated.Value(deviceHeight)).current;\n\n  const slideIn = () => {\n    Animated.timing(slideAnim, {\n      toValue: (7.3891 * deviceHeight) / 100,\n      duration: 300,\n      easing: Easing.exp,\n      useNativeDriver: Platform.OS !== 'web' ? true : false,\n    }).start();\n  };\n\n  const slideOut = () => {\n    Animated.timing(slideAnim, {\n      toValue: deviceHeight,\n      duration: 400,\n      easing: Easing.exp,\n      useNativeDriver: Platform.OS !== 'web' ? true : false,\n    }).start((anim) => {\n      if (anim.finished) {\n        setTimeout(onClose, 100);\n      }\n    });\n  };\n\n  const slideInAnimationStyle = [\n    smartpriceModalStyles.containerViewStyle,\n    {\n      marginTop: slideAnim,\n    },\n  ];\n\n  const activityIndicatorStyle: ViewStyle = {\n    ...smartpriceModalStyles.activityIndicatorViewStyle,\n    display: isBusy ? 'flex' : 'none',\n  };\n\n  useEffect(() => {\n    if (isOpen === true) {\n      slideIn();\n    }\n  }, [isOpen]);\n\n  return (\n    <View style={viewStyle}>\n      <Animated.View style={slideInAnimationStyle}>\n        <SmartpriceModalHeader\n          isBackButtonEnabled={backButton}\n          onClose={onCloseModal}\n          onBackButtonPressed={onBackButtonPressed}\n        />\n        <View style={smartpriceModalStyles.scrollContainerViewStyle}>\n          <View style={smartpriceModalStyles.formContainerViewStyle}>\n            {switchForm(flowStep)}\n          </View>\n          <SmartpriceFooter />\n        </View>\n        <View style={activityIndicatorStyle}>\n          <ActivityIndicator\n            hidesWhenStopped={true}\n            color={PurpleScale.dark}\n            animating={isBusy}\n            size='large'\n          />\n        </View>\n      </Animated.View>\n    </View>\n  );\n};\n"]},"metadata":{},"sourceType":"script"}